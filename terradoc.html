<!DOCTYPE html>
<html>
	<head lang="en">

		<meta charset="UTF-8">
		<title>Terraform object search</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		
		<link href="hashi.css" rel="stylesheet" type="text/css" />

		<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
		<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.jquery.min.js"></script>
		<!--script src="../dist/FuzzySearch.min.js"></script-->
		<script src="../dist/FuzzySearch.js"></script>



	</head>
	<body>
    <div id="header" class="navigation navbar-static-top hidden-print">
      <div class="container">
        <div class="row">
          <div class="col-xs-12">
            <div class="navbar-header">
              <div class="navbar-brand">
								<a href="/">
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 251 61" class="logo white" height="50">
										<path class="text" fill="#000" fill-rule="nonzero" d="M81.78 19.54h-8.89v-5.31H96.7v5.31h-8.9v26.53h-6"></path>
											<path class="text" fill="#000" fill-rule="nonzero" d="M102.19 41.77c2.415-.012 4.814-.383 7.12-1.1l.91 4.4c-2.745.99-5.642 1.49-8.56 1.48-7.31 0-9.85-3.39-9.85-9V31.4c0-4.92 2.2-9.08 9.66-9.08s9.13 4.35 9.13 9.37v5h-13v1.2c.05 2.78 1.05 3.88 4.59 3.88zM97.65 32h7.41v-1.18c0-2.2-.67-3.73-3.54-3.73s-3.87 1.53-3.87 3.73V32zm28.54-4.33c-2.148.97-4.217 2.102-6.19 3.39v15h-5.83V22.79h4.92l.38 2.58c1.897-1.284 3.955-2.313 6.12-3.06l.6 5.36zm14.24 0c-2.14.97-4.204 2.103-6.17 3.39v15h-5.83V22.79h4.92l.38 2.58c1.897-1.284 3.955-2.313 6.12-3.06l.58 5.36zm19.51 18.4h-4.78l-.43-1.58c-2.062 1.342-4.47 2.058-6.93 2.06-4.25 0-6.07-2.92-6.07-6.93 0-4.73 2.06-6.55 6.79-6.55h5.59v-2.44c0-2.58-.72-3.49-4.45-3.49-2.17.024-4.33.266-6.45.72l-.72-4.45c2.606-.72 5.296-1.09 8-1.1 7.31 0 9.47 2.58 9.47 8.41l-.02 15.35zm-5.83-8.8h-4.3c-1.91 0-2.44.53-2.44 2.29s.53 2.34 2.34 2.34c1.544-.024 3.058-.436 4.4-1.2v-3.43zm23.75-19.79c-1.1-.237-2.224-.364-3.35-.38-2.29 0-2.63 1-2.63 2.77v2.92h5.93l-.33 4.64h-5.59v18.64h-5.83V27.43h-3.73v-4.64h3.73v-3.25c0-4.83 2.25-7.22 7.41-7.22 1.69-.006 3.372.22 5 .67l-.61 4.49zm11.38 29.07c-8 0-10.13-4.4-10.13-9.18v-5.88c0-4.78 2.15-9.18 10.13-9.18s10.13 4.4 10.13 9.18v5.88c.01 4.78-2.15 9.18-10.13 9.18zm0-19.27c-3.11 0-4.3 1.39-4.3 4v6.26c0 2.63 1.2 4 4.3 4 3.1 0 4.3-1.39 4.3-4V31.3c0-2.63-1.19-4.02-4.3-4.02zm25.14.39c-2.14.97-4.204 2.103-6.17 3.39v15h-5.83V22.79h4.92l.38 2.58c1.897-1.284 3.954-2.313 6.12-3.06l.58 5.36zm16.02 18.4V29.82c0-1.24-.53-1.86-1.86-1.86-2.137.254-4.2.934-6.07 2v16.11h-5.83V22.79h4.45l.57 2c2.906-1.47 6.088-2.315 9.34-2.48 1.843-.174 3.6.82 4.4 2.49 2.91-1.49 6.104-2.34 9.37-2.49 3.87 0 5.26 2.72 5.26 6.88v16.88h-5.83V29.82c0-1.24-.53-1.86-1.86-1.86-2.14.236-4.208.917-6.07 2v16.11h-5.87z"></path>
												<path class="rect-dark" fill="#4040B2" d="M36.4 39.13l16.4-9.46V10.72L36.4 20.2"></path>
													<path class="rect-light" fill="#5C4EE5" d="M18.2 10.72l16.4 9.48v18.93l-16.4-9.47"></path>
														<path class="rect-light" fill="#5C4EE5" d="M0 19.09l16.4 9.47V9.62L0 .15m18.2 50.53l16.4 9.47V41.21l-16.4-9.47"></path>
								</svg>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="container">
				<div class="jumbotron typeahead searchbox">
					<form>
						<div class="form-group row">
					<label for "demo-query-ui-auto">Search:</label>
					<input id="demo-query-ui-auto" class="twitter-typeahead center-block" name="demo-query-ui-auto" autocomplete="off" type="text" placeholder="search term">
						</div>
					</form>
				</div>

			<div id="links" class="row">
			</div>

			<div class="row">
				<p id="output" ></p>
			</div>
		</div>

		<!-- allow to scroll so autocomplete is at top of page -->
		<div style="height: 500px;"></div>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
		<script>

			//
			// Create main object
			// We will fill the data once we have the JSON loaded
			//

			var fuzzyhound = new FuzzySearch({output_limit: 6, output_map:"alias"});

			// output_limit: number of item to return
			//
			// output_map:"alias" : Build a custom output object.
			//                      This can be used to reuse same template with different source format
			//                      Input - Output mapping is set using keys options see "Dataset switch UI" below


			// - - - - - - - - - - - - - - - - - - - - - - -
			//    Item template, shared for both auto-completes
			// - - - - - - - - - - - - - - - - - - - - - - -

			function itemTemplate(suggestion) {

				//This template is the same despite the fact source input change format.
				//This is because we use alias option to transform output.

				// to make the specific search (title:, author:) work with highlight
				// the highlight function take an optional second argument: tag name (alias)

				return [
					"<div>",
					"<span class='type'>", fuzzyhound.highlight(suggestion.type,"type"),":", "</span>",
					"<span class='provider'>",  fuzzyhound.highlight(suggestion.provider,"provider"), "_" , "</span>",
					"<span class='name'>", fuzzyhound.highlight(suggestion.name,"name"), "</span>",
					"</div>"
				].join("");

			}


			//- - - - - - - - - - -
			//    Jquery UI Setup
			// - - - - - - - - - - -

			var $el  = $("#demo-query-ui-auto");
			$el.autocomplete({
				minLength: 2,
				delay: 0, //use FuzzySearch debounce
				source: function (request, response) {
					response(fuzzyhound.search(request.term));
				},
				select: function( event, ui  ) {
					$.get("providers/" + ui.item.display, function(data, status){
						$(".ui-helper-hidden-accessible").remove();
						var inner = $("#inner", data);
						$("#output").html(inner); 
						$("#inner").removeClass().addClass('container');
						$('#links').html(
							'<div><ul class="nav justify-content-center">' +
							'<li class="nav_item"><a class="nav-link" href="https://github.com/terraform-providers/terraform-provider-' + ui.item.item.provider + '">Provider: ' + ui.item.item.provider +'</a></li>'+
							'<li class="nav_item"><a class="nav-link" href="' + ui.item.item.source_url + '">' + ui.item.item.type + ':' + ui.item.item.name + '</a></li>'+
							'</div>'
						) ;
					});

				}
			});

			//Get instance to extend
			var $inst = $el.autocomplete("instance");

			//Custom item
			$inst._renderItem = function (ul, item) {
				return $("<li>").append(itemTemplate(item)).appendTo(ul);
			};

			//Custom footer
			$inst._renderMenu = function (ul, items) {
				var nbitems = items.length, i = -1;
				while (++i < nbitems) {
					var display = items[i].provider +"_"+ items[i].name;
					this._renderItem(ul, items[i]).data("ui-autocomplete-item",{display: items[i].doc_url, value: display, item: items[i]});
				}
			};


			// - - - - - - - - - - - -
			//   Setup dataset switch
			//- - - - - - - - - - - - -

			$.ajaxSetup({cache: true});
			function setsource(url, keys) {
				$.getJSON(url).then(function (response) {
					fuzzyhound.setOptions({
						source: response,
						keys: keys
					})
				});
			}

			//Load small dataset by default
			setsource("awk-mod.json", ["provider", "type", "name", "doc_url", "source_url"] );

			// - - - - - - - - - - - -
			//   Dataset switch UI
			//- - - - - - - - - - - - -


			$('#free').change(function () {
				fuzzyhound.setOptions({
					score_per_token: $(this).is(":checked")
				})
			});

			$('#fused').change(function () {
				fuzzyhound.setOptions({
					score_test_fused: $(this).is(":checked")
				});
			});

			$('#acro').change(function () {
				fuzzyhound.setOptions({
					score_acronym:$(this).is(":checked"),
					dirty: true     //Acronym building is done at source processing stage so we need to reprocess the source.
				});
			});

			$('#store').change(function () {
				fuzzyhound.setOptions({
					use_index_store: $(this).is(":checked"),
					dirty: true     //store is done at source processing stage so we need to reprocess the source.
				});
			});


		</script>
	</body>
</html>
